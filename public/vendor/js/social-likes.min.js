(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery)}}(function(d,b){var g="social-likes";var m=g+"__";var f=g+"_opened";var q=location.protocol==="https:"?"https:":"http:";var p=q==="https:";var l={facebook:{counterUrl:"https://graph.facebook.com/fql?q=SELECT+total_count+FROM+link_stat+WHERE+url%3D%22{url}%22&callback=?",convertNumber:function(r){return r.data[0].total_count},popupUrl:"https://www.facebook.com/sharer/sharer.php?u={url}",popupWidth:600,popupHeight:500},twitter:{counterUrl:"https://cdn.api.twitter.com/1/urls/count.json?url={url}&callback=?",convertNumber:function(r){return r.count},popupUrl:"https://twitter.com/intent/tweet?url={url}&text={title}",popupWidth:600,popupHeight:450,click:function(){if(!/[\.\?:\-–—]\s*$/.test(this.options.title)){this.options.title+=":"}return true}},mailru:{counterUrl:q+"//connect.mail.ru/share_count?url_list={url}&callback=1&func=?",convertNumber:function(s){for(var r in s){if(s.hasOwnProperty(r)){return s[r].shares}}},popupUrl:q+"//connect.mail.ru/share?share_url={url}&title={title}",popupWidth:550,popupHeight:360},vkontakte:{counterUrl:"https://vk.com/share.php?act=count&url={url}&index={index}",counter:function(u,r){var t=l.vkontakte;if(!t._){t._=[];if(!window.VK){window.VK={}}window.VK.Share={count:function(v,w){t._[v].resolve(w)}}}var s=t._.length;t._.push(r);d.getScript(c(u,{index:s})).fail(r.reject)},popupUrl:q+"//vk.com/share.php?url={url}&title={title}",popupWidth:550,popupHeight:330},odnoklassniki:{counterUrl:p?b:"http://connect.ok.ru/dk?st.cmd=extLike&ref={url}&uid={index}",counter:function(u,r){var t=l.odnoklassniki;if(!t._){t._=[];if(!window.ODKL){window.ODKL={}}window.ODKL.updateCount=function(v,w){t._[v].resolve(w)}}var s=t._.length;t._.push(r);d.getScript(c(u,{index:s})).fail(r.reject)},popupUrl:"http://connect.ok.ru/dk?st.cmd=WidgetSharePreview&service=odnoklassniki&st.shareUrl={url}",popupWidth:550,popupHeight:360},plusone:{counterUrl:p?b:"http://share.yandex.ru/gpp.xml?url={url}",counter:function(t,r){var s=l.plusone;if(s._){r.reject();return}if(!window.services){window.services={}}window.services.gplus={cb:function(u){if(typeof u==="string"){u=u.replace(/\D/g,"")}s._.resolve(parseInt(u,10))}};s._=r;d.getScript(c(t)).fail(r.reject)},popupUrl:"https://plus.google.com/share?url={url}",popupWidth:700,popupHeight:500},pinterest:{counterUrl:q+"//api.pinterest.com/v1/urls/count.json?url={url}&callback=?",convertNumber:function(r){return r.count},popupUrl:q+"//pinterest.com/pin/create/button/?url={url}&description={title}",popupWidth:630,popupHeight:270}};var k={promises:{},fetch:function(r,u,x){if(!k.promises[r]){k.promises[r]={}}var v=k.promises[r];if(!x.forceUpdate&&v[u]){return v[u]}else{var t=d.extend({},l[r],x);var s=d.Deferred();var w=t.counterUrl&&c(t.counterUrl,{url:u});if(w&&d.isFunction(t.counter)){t.counter(w,s)}else{if(t.counterUrl){d.getJSON(w).done(function(z){try{var y=z;if(d.isFunction(t.convertNumber)){y=t.convertNumber(z)}s.resolve(y)}catch(A){s.reject()}}).fail(s.reject)}else{s.reject()}}v[u]=s.promise();return v[u]}}};d.fn.socialLikes=function(r){return this.each(function(){var t=d(this);var s=t.data(g);if(s){if(d.isPlainObject(r)){s.update(r)}}else{s=new j(t,d.extend({},d.fn.socialLikes.defaults,r,i(t)));t.data(g,s)}})};d.fn.socialLikes.defaults={url:window.location.href.replace(window.location.hash,""),title:document.title,counters:true,zeroes:false,wait:500,timeout:10000,popupCheckInterval:500,singleTitle:"Share",initHtml:true};function j(r,s){this.container=r;this.options=s;this.init()}j.prototype={init:function(){this.container.addClass(g);this.single=this.container.hasClass(g+"_single");this.initUserButtons();this.countersLeft=0;this.number=0;this.container.on("counter."+g,d.proxy(this.updateCounter,this));var r=this.container.children();this.makeSingleButton();this.buttons=[];r.each(d.proxy(function(s,u){var t=new e(d(u),this.options);this.buttons.push(t);if(t.options.counterUrl){this.countersLeft++}},this));if(this.options.counters){this.timer=setTimeout(d.proxy(this.appear,this),this.options.wait);this.timeout=setTimeout(d.proxy(this.ready,this,true),this.options.timeout)}else{this.appear()}},initUserButtons:function(){if(!this.userButtonInited&&window.socialLikesButtons){d.extend(true,l,socialLikesButtons)}this.userButtonInited=true},makeSingleButton:function(){if(!this.single){return}var r=this.container;r.addClass(g+"_vertical");r.wrap(d("<div>",{"class":g+"_single-w"}));r.wrapInner(d("<div>",{"class":g+"__single-container"}));var u=r.parent();var t=d("<div>",{"class":h("widget","single")});var s=d(o('<div class="{buttonCls}"><span class="{iconCls}"></span>{title}</div>',{buttonCls:h("button","single"),iconCls:h("icon","single"),title:this.options.singleTitle}));t.append(s);u.append(t);t.on("click",function(){var v=g+"__widget_active";t.toggleClass(v);if(t.hasClass(v)){r.css({left:-(r.width()-t.width())/2,top:-r.height()});a(r);n(r,function(){t.removeClass(v)})}else{r.removeClass(f)}return false});this.widget=t},update:function(r){if(!r.forceUpdate&&r.url===this.options.url){return}this.number=0;this.countersLeft=this.buttons.length;if(this.widget){this.widget.find("."+g+"__counter").remove()}d.extend(this.options,r);for(var s=0;s<this.buttons.length;s++){this.buttons[s].update(r)}},updateCounter:function(t,r,s){if(s){this.number+=s;if(this.single){this.getCounterElem().text(this.number)}}this.countersLeft--;if(this.countersLeft===0){this.appear();this.ready()}},appear:function(){this.container.addClass(g+"_visible")},ready:function(r){if(this.timeout){clearTimeout(this.timeout)}this.container.addClass(g+"_ready");if(!r){this.container.trigger("ready."+g,this.number)}},getCounterElem:function(){var r=this.widget.find("."+m+"counter_single");if(!r.length){r=d("<span>",{"class":h("counter","single")});this.widget.append(r)}return r}};function e(s,r){this.widget=s;this.options=d.extend({},r);this.detectService();if(this.service){this.init()}}e.prototype={init:function(){this.detectParams();if(this.options.initHtml){this.initHtml()}else{this.widget.on("click",d.proxy(this.click,this))}setTimeout(d.proxy(this.initCounter,this),0)},update:function(r){d.extend(this.options,{forceUpdate:false},r);this.widget.find("."+g+"__counter").remove();this.initCounter()},detectService:function(){var r=this.widget.data("service");if(!r){var u=this.widget[0];var t=u.classList||u.className.split(" ");for(var v=0;v<t.length;v++){var s=t[v];if(l[s]){r=s;break}}if(!r){return}}this.service=r;d.extend(this.options,l[r])},detectParams:function(){var s=this.widget.data();if(s.counter){var r=parseInt(s.counter,10);if(isNaN(r)){this.options.counterUrl=s.counter}else{this.options.counterNumber=r}}if(s.title){this.options.title=s.title}if(s.url){this.options.url=s.url}},initHtml:function(){var t=this.options;var w=this.widget;var r=w.find("a");if(r.length){this.cloneDataAttrs(r,w)}var u=d("<span>",{"class":this.getElementClassNames("button"),text:w.text()});if(t.clickUrl){var s=c(t.clickUrl,{url:t.url,title:t.title});var v=d("<a>",{href:s});this.cloneDataAttrs(w,v);w.replaceWith(v);this.widget=w=v}else{w.on("click",d.proxy(this.click,this))}w.removeClass(this.service);w.addClass(this.getElementClassNames("widget"));u.prepend(d("<span>",{"class":this.getElementClassNames("icon")}));w.empty().append(u);this.button=u},initCounter:function(){if(this.options.counters){if(this.options.counterNumber){this.updateCounter(this.options.counterNumber)}else{var r={counterUrl:this.options.counterUrl,forceUpdate:this.options.forceUpdate};k.fetch(this.service,this.options.url,r).always(d.proxy(this.updateCounter,this))}}},cloneDataAttrs:function(u,r){var t=u.data();for(var s in t){if(t.hasOwnProperty(s)){r.data(s,t[s])}}},getElementClassNames:function(r){return h(r,this.service)},updateCounter:function(s){s=parseInt(s,10)||0;var t={"class":this.getElementClassNames("counter"),text:s};if(!s&&!this.options.zeroes){t["class"]+=" "+g+"__counter_empty";t.text=""}var r=d("<span>",t);this.widget.append(r);this.widget.trigger("counter."+g,[this.service,s])},click:function(u){var s=this.options;var t=true;if(d.isFunction(s.click)){t=s.click.call(this,u)}if(t){var r=c(s.popupUrl,{url:s.url,title:s.title});r=this.addAdditionalParamsToUrl(r);this.openPopup(r,{width:s.popupWidth,height:s.popupHeight})}return false},addAdditionalParamsToUrl:function(r){var t=d.param(d.extend(this.widget.data(),this.options.data));if(d.isEmptyObject(t)){return r}var s=r.indexOf("?")===-1?"?":"&";return r+s+t},openPopup:function(r,v){var u=Math.round(screen.width/2-v.width/2);var t=0;if(screen.height>v.height){t=Math.round(screen.height/3-v.height/2)}var s=window.open(r,"sl_"+this.service,"left="+u+",top="+t+",width="+v.width+",height="+v.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");if(s){s.focus();this.widget.trigger("popup_opened."+g,[this.service,s]);var w=setInterval(d.proxy(function(){if(!s.closed){return}clearInterval(w);this.widget.trigger("popup_closed."+g,this.service)},this),this.options.popupCheckInterval)}else{location.href=r}}};function i(u){function t(x,y){return y.toUpper()}var r={};var w=u.data();for(var s in w){var v=w[s];if(v==="yes"){v=true}else{if(v==="no"){v=false}}r[s.replace(/-(\w)/g,t)]=v}return r}function c(r,s){return o(r,s,encodeURIComponent)}function o(r,s,t){return r.replace(/\{([^\}]+)\}/g,function(u,v){return v in s?(t?t(s[v]):s[v]):u})}function h(t,s){var r=m+t;return r+" "+r+"_"+s}function n(t,v){function s(w){if((w.type==="keydown"&&w.which!==27)||d(w.target).closest(t).length){return}t.removeClass(f);u.off(r,s);if(d.isFunction(v)){v()}}var u=d(document);var r="click touchstart keydown";u.on(r,s)}function a(s){var v=10;if(document.documentElement.getBoundingClientRect){var u=parseInt(s.css("left"),10);var t=parseInt(s.css("top"),10);var r=s[0].getBoundingClientRect();if(r.left<v){s.css("left",v-r.left+u)}else{if(r.right>window.innerWidth-v){s.css("left",window.innerWidth-r.right-v+u)}}if(r.top<v){s.css("top",v-r.top+t)}else{if(r.bottom>window.innerHeight-v){s.css("top",window.innerHeight-r.bottom-v+t)}}}s.addClass(f)}d(function(){d("."+g).socialLikes()})}));